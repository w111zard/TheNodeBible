+ **callbacks** (функции обратного вызова) - являются основным строительным блоком для выполнения асинхронных программ. Промисы, async/await основаны на колбеках 

# Паттерн callback'ов

В синхронном программирования для получения результата выполнения функции используется `return`. Для асинхронного кода используются callbacks, которые возвращает результаты асинхронных операций

## Continuation-passing style (CPS)

В основе callback'ов лежит паттерн из функционального программирования, называемый **continuation-passing style (CPS)**. Сам по себе паттерн никак не относится к асинхронному программированию. Это просто другой вариант для возвращения значения из функции, вместо `return`

```javascript
// direct style
function add(a, b) {
  return a + b;
}

// CPS style
function add(a ,b, callback) {
  return callback(a + b);
}
```

## Callback всегда идет последним

callback всегда должен быть последним параметром функции/метода

```javascript
function readFile(file, encoding, callback) {
  // ...
}
```

## Ошибка всегда идет первой

В callback'е, по правилам хорошего тона, первым аргументом всегда должна передаваться ошибка. Остальные аргументы обозначают результаты

```javascript
callback(error, data1, data2)
```

## Zalgo

Функции и методы должны быть либо синхронными, либо асинхронными. Нельзя писать функции, методы, которые в зависимости от ситуации работают синхронно/асинхронно. Это может привести к очень неочевидным ошибкам! 

Пример функции, которая работает по-разному в разных ситуациях:

```javascript
function unpredicatableReader(file, callback) {
  if (cache.has(file)) {
    const data = cache.get(file);
    return callback(null, data);
  }
  
  fs.readFile(file, 'utf8', (err, data) => {
    // ...
  })
}
```

Пример того, к каким ошибкам это может приводить, есть в [файле](zalgo.mjs)